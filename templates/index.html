<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>幸运转盘游戏</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      background: #f9f9f9;
      font-family: Arial, sans-serif;
    }

    .wheel {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 10px solid #333;
      position: relative;
      overflow: hidden;
      transition: transform 4s cubic-bezier(0.33, 1, 0.68, 1);
    }

    .wheel div {
      position: absolute;
      width: 50%;
      height: 50%;
      background: #ffcc00;
      transform-origin: 100% 100%;
      border: 1px solid #333;
    }

    .wheel div:nth-child(1) { transform: rotate(0deg) skewY(-60deg); background: #ff9999; }
    .wheel div:nth-child(2) { transform: rotate(60deg) skewY(-60deg); background: #99ccff; }
    .wheel div:nth-child(3) { transform: rotate(120deg) skewY(-60deg); background: #99ff99; }
    .wheel div:nth-child(4) { transform: rotate(180deg) skewY(-60deg); background: #ffcc99; }
    .wheel div:nth-child(5) { transform: rotate(240deg) skewY(-60deg); background: #cc99ff; }
    .wheel div:nth-child(6) { transform: rotate(300deg) skewY(-60deg); background: #ffff99; }

    .arrow {
      width: 0; 
      height: 0; 
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 40px solid red;
      position: absolute;
      top: -40px;
      left: calc(50% - 20px);
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="wheel-container">
    <div class="arrow"></div>
    <div class="wheel" id="wheel">
      <div></div><div></div><div></div>
      <div></div><div></div><div></div>
    </div>
  </div>

  <button onclick="spin()">开始抽奖</button>
  <div id="result"></div>

  <script>
    let wheel = document.getElementById("wheel");
    let isSpinning = false;

    async function spin() {
      if (isSpinning) return;
      isSpinning = true;

      // 向后端请求一个随机结果
      let response = await fetch("/spin");
      let data = await response.json();
      let prizeIndex = data.index; // 后端返回的奖品索引
      let prizeName = data.prize;

      // 每个奖品占 60 度（360/6）
      let degrees = 360 * 5 + (360 - prizeIndex * 60 - 30); 
      // 旋转动画
      wheel.style.transform = `rotate(${degrees}deg)`;

      setTimeout(() => {
        document.getElementById("result").innerText = "结果：" + prizeName;
        isSpinning = false;
      }, 4500);
    }
  </script>
</body>
</html>
